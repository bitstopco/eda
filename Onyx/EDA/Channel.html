<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.27.2">


<link href="../../css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="../../js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "../../";
</script>

  <meta id="repository-name" content="github.com/onyxframework/event">
  <title>Onyx::EDA::Channel - github.com/onyxframework/event</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="../../index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent open current" data-id="github.com/onyxframework/event/Onyx" data-name="onyx">
      <a href="../../Onyx.html">Onyx</a>
      
        <ul>
  
  <li class="parent open current" data-id="github.com/onyxframework/event/Onyx/EDA" data-name="onyx::eda">
      <a href="../../Onyx/EDA.html">EDA</a>
      
        <ul>
  
  <li class="parent open current" data-id="github.com/onyxframework/event/Onyx/EDA/Channel" data-name="onyx::eda::channel">
      <a href="../../Onyx/EDA/Channel.html">Channel</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/event/Onyx/EDA/Channel/ProcNotSubscribedError" data-name="onyx::eda::channel::procnotsubscribederror">
      <a href="../../Onyx/EDA/Channel/ProcNotSubscribedError.html">ProcNotSubscribedError</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/event/Onyx/EDA/Channel/Redis" data-name="onyx::eda::channel::redis">
      <a href="../../Onyx/EDA/Channel/Redis.html">Redis</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/event/Onyx/EDA/Event" data-name="onyx::eda::event">
      <a href="../../Onyx/EDA/Event.html">Event</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  <span class="kind">class</span> Onyx::EDA::Channel

</h1>


  <ul class="superclass-hierarchy"><li class="superclass"><a href="../../Onyx/EDA/Channel.html">Onyx::EDA::Channel</a></li><li class="superclass">Reference</li><li class="superclass">Object</li></ul>




  <h2>Overview</h2>

  <p>An in-memory event channel.
<strong>Asynchronously</strong> notifies all its subscribers on a new <code><a href="../../Onyx/EDA/Event.html">Event</a></code>.</p>

<pre><code>channel <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">EDA</span><span class="t">::</span><span class="t">Channel</span>.<span class="k">new</span>
channel.subscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) { <span class="o">|</span>e<span class="o">|</span> pp e }
channel.emit(<span class="t">MyEvent</span>.<span class="k">new</span>)
sleep(<span class="n">0.01</span>) <span class="c"># Need to yield the control, because all notifications are async</span></code></pre>









  <h2>Direct Known Subclasses</h2>
  <ul class="other-types-list">
  
    <li class="other-type"><a href="../../Onyx/EDA/Channel/Redis.html">Onyx::EDA::Channel::Redis</a></li>
  
  </ul>






  <h2>Defined in:</h2>
  
    
      <a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L13" target="_blank">
        onyx-eda/channel.cr
      </a>
    
    <br/>
  









  <h2>Instance Method Summary</h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#emit%28events%3AEnumerable%28T%29%29forallT-instance-method" class="signature"><strong>#emit</strong>(events : Enumerable(T)) forall T</a>
        
          <div class="summary"><p>Emit <em>events</em>, notifying all its subscribers.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#emit%28%2Aevents%3A%2AT%29forallT-instance-method" class="signature"><strong>#emit</strong>(*events : <span class="o">*</span><span class="t">T</span>) forall T</a>
        
          <div class="summary"><p>Emit <em>events</em>, notifying all its subscribers.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#subscribe%28object%2Cevent%3AT.class%2C%26proc%3AT-%3ENil%29%3AEnumerable%28String%29forallT-instance-method" class="signature"><strong>#subscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>, &proc : T -> Nil) : Enumerable(String) forall T</a>
        
          <div class="summary"><p>Subscribe an <em>object</em> to <em>event</em>, calling <em>proc</em> on event emit.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unsubscribe%28object%2Cevent%3AT.class%2C%26proc%3AT-%3ENil%29%3AEnumerable%28String%29forallT-instance-method" class="signature"><strong>#unsubscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>, &proc : T -> Nil) : Enumerable(String) forall T</a>
        
          <div class="summary"><p>Unsubscribe an <em>object</em> from <em>event</em> notifications by <em>proc</em>.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unsubscribe%28object%2Cevent%3AT.class%29%3AEnumerable%28String%29forallT-instance-method" class="signature"><strong>#unsubscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>) : Enumerable(String) forall T</a>
        
          <div class="summary"><p>Unsubscribe an <em>object</em> from all <em>event</em> notifications.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unsubscribe%28object%29%3AEnumerable%28String%29-instance-method" class="signature"><strong>#unsubscribe</strong>(object) : Enumerable(String)</a>
        
          <div class="summary"><p>Unsubscribe an <em>object</em> from all events.</p></div>
        
      </li>
    
  </ul>





<div class="methods-inherited">
  
    


    


    


  
    


    


    


  
</div>






  <h2>Instance Method Detail</h2>
  
    <div class="entry-detail" id="emit(events:Enumerable(T))forallT-instance-method">
      <div class="signature">
        
        def <strong>emit</strong>(events : Enumerable(T)) forall T

        <a class="method-permalink" href="#emit%28events%3AEnumerable%28T%29%29forallT-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Emit <em>events</em>, notifying all its subscribers.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L20" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="emit(*events:*T)forallT-instance-method">
      <div class="signature">
        
        def <strong>emit</strong>(*events : <span class="o">*</span><span class="t">T</span>) forall T

        <a class="method-permalink" href="#emit%28%2Aevents%3A%2AT%29forallT-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Emit <em>events</em>, notifying all its subscribers.</p></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L15" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="subscribe(object,event:T.class,&amp;proc:T-&gt;Nil):Enumerable(String)forallT-instance-method">
      <div class="signature">
        
        def <strong>subscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>, &proc : T -> Nil) : Enumerable(String) forall T

        <a class="method-permalink" href="#subscribe%28object%2Cevent%3AT.class%2C%26proc%3AT-%3ENil%29%3AEnumerable%28String%29forallT-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Subscribe an <em>object</em> to <em>event</em>, calling <em>proc</em> on event emit.</p>

<p>Channel distinguishes subscribers by their <code>object.hash</code>.
You can have a single object subscribed to multiple events with multiple procs.
You can specify an abstract object, as well as a module in addition to
standard class and struct as <em>event</em>.</p>

<p>Returns an array of the <strong>newly</strong> added event class names to watch,
skipping those which already have <em>at least one</em> subscriber.</p>

<p><span class="flag red">BUG</span>  You currently can not pass a <code>Union</code> as an <em>event</em> argument.
Please subscribe multiple times with different events instead.</p>

<pre><code><span class="k">abstract</span> <span class="k">struct</span> <span class="t">AppEvent</span> <span class="o">&lt;</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">EDA</span><span class="t">::</span><span class="t">Event</span>
<span class="k">end</span>

<span class="k">struct</span> <span class="t">MyEvent</span> <span class="o">&lt;</span> <span class="t">AppEvent</span>
  getter foo

  <span class="k">def</span> <span class="m">initialize</span>(@foo : <span class="t">String</span>)
  <span class="k">end</span>
<span class="k">end</span>

channel.subscribe(<span class="t">Object</span>, <span class="t">AppEvent</span>) <span class="k">do</span> <span class="o">|</span>event<span class="o">|</span>
  pp event.foo
<span class="k">end</span> <span class="c"># =&gt; [&quot;MyEvent&quot;]</span>

channel.subscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) <span class="k">do</span> <span class="o">|</span>event<span class="o">|</span>
  pp event.foo
<span class="k">end</span> <span class="c"># =&gt; []</span>

channel.emit(<span class="t">MyEvent</span>.<span class="k">new</span>(<span class="s">&quot;bar&quot;</span>)) <span class="c"># Will print &quot;bar&quot; two times</span></code></pre>

<p>You obviously can use it within objects as well:</p>

<pre><code><span class="k">class</span> <span class="t">Notifier</span>
  <span class="k">def</span> <span class="m">initialize</span>(channel)
    channel.subscribe(<span class="k">self</span>, <span class="t">MyEvent</span>) { }
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">stop</span>
    channel.unsubscribe(<span class="k">self</span>)
  <span class="k">end</span>
<span class="k">end</span>

notifier <span class="o">=</span> <span class="t">Notifier</span>.<span class="k">new</span>(channel)

<span class="c"># ...</span>

channel.unsubscribe(notifier)
<span class="c"># Or</span>
notifier.stop</code></pre></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L82" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="unsubscribe(object,event:T.class,&amp;proc:T-&gt;Nil):Enumerable(String)forallT-instance-method">
      <div class="signature">
        
        def <strong>unsubscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>, &proc : T -> Nil) : Enumerable(String) forall T

        <a class="method-permalink" href="#unsubscribe%28object%2Cevent%3AT.class%2C%26proc%3AT-%3ENil%29%3AEnumerable%28String%29forallT-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Unsubscribe an <em>object</em> from <em>event</em> notifications by <em>proc</em>.
The mentioned proc will not be called again for this subscriber.</p>

<p><span class="flag purple">NOTE</span>  You should pass exactly the same proc object.
<code><a href="../../Onyx/EDA/Channel/ProcNotSubscribedError.html">ProcNotSubscribedError</a></code> is raised otherwise.</p>

<p>Returns an array of event class names which are not watched anymore,
i.e. those which have <em>zero</em> subscribers after this method call.</p>

<pre><code>proc <span class="o">=</span> ->(e : <span class="t">MyEvent</span>) { pp e }

channel.subscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>, <span class="o">&amp;</span>proc)

<span class="c"># Would raise ProcNotSubscribedError</span>
channel.unsubscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) <span class="k">do</span> <span class="o">|</span>e<span class="o">|</span>
  pp e
<span class="k">end</span>

<span class="c"># OK</span>
channel.unsubscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>, <span class="o">&amp;</span>proc) <span class="c"># =&gt; [&quot;MyEvent&quot;]</span></code></pre></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L108" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="unsubscribe(object,event:T.class):Enumerable(String)forallT-instance-method">
      <div class="signature">
        
        def <strong>unsubscribe</strong>(object, event : <span class="t">T</span>.<span class="k">class</span>) : Enumerable(String) forall T

        <a class="method-permalink" href="#unsubscribe%28object%2Cevent%3AT.class%29%3AEnumerable%28String%29forallT-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Unsubscribe an <em>object</em> from all <em>event</em> notifications.</p>

<p>Returns an array of event class names which are not watched anymore,
i.e. those which have <em>zero</em> subscribers after this method call.</p>

<pre><code>channel.subscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) <span class="k">do</span> <span class="o">|</span>event<span class="o">|</span>
  pp event
<span class="k">end</span>

channel.unsubscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) <span class="c"># =&gt; [&quot;MyEvent&quot;]</span></code></pre></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L124" target="_blank">View source</a>]
        
      </div>
    </div>
  
    <div class="entry-detail" id="unsubscribe(object):Enumerable(String)-instance-method">
      <div class="signature">
        
        def <strong>unsubscribe</strong>(object) : Enumerable(String)

        <a class="method-permalink" href="#unsubscribe%28object%29%3AEnumerable%28String%29-instance-method">#</a>
      </div>
      
        <div class="doc"><p>Unsubscribe an <em>object</em> from all events.</p>

<p>Returns an array of event class names which are not watched anymore,
i.e. those which have <em>zero</em> subscribers after this method call.</p>

<pre><code>channel.subscribe(<span class="t">Object</span>, <span class="t">MyEvent</span>) <span class="k">do</span> <span class="o">|</span>event<span class="o">|</span>
  pp event
<span class="k">end</span>

channel.unsubscribe(<span class="t">Object</span>) <span class="c"># =&gt; [&quot;MyEvent&quot;]</span></code></pre></div>
      
      <br/>
      <div>
        
          [<a href="https://github.com/onyxframework/event/blob/6a6a7d56b820aca7b5ead0cee6a063627d3287a4/src/onyx-eda/channel.cr#L140" target="_blank">View source</a>]
        
      </div>
    </div>
  




</div>

</body>
</html>
